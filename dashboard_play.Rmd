---
title: "Dashboard play"
author: "O.P"
date: "2022-08-23"
output: 
  flexdashboard::flex_dashboard:
    source_code: embed
    orientation: rows
    vertical_layout: scroll
---

```{r Set up}
library(ggplot2)
library(shiny)
library(plotly)
library(dplyr)
library(tidyverse)
library(multcompView)
library(plotrix)

country_info <- readRDS("country.info.rds")
life_expect_df_2 <- readRDS("life.expect.df.2.RDS")
life_expect_df <- readRDS("life.expect.df.RDS")
dt3 <- readRDS("dt3.RDS")
cld3 <- readRDS("cld3.RDS")

# Summarize data for the scatter plots
region_mort_tb1 <- country_info %>%
  dplyr::select(country, region, life_expectancy_birth, mortality_rate)

region_mort_tb2 <- region_mort_tb1 %>%
  # Create new column with categorization of life expectancy at birth
  mutate(life_expect_class = ifelse(life_expectancy_birth >= 74.76, "High",
                                  ifelse(life_expectancy_birth >= 70.07, "High-moderate",
                                         ifelse(life_expectancy_birth >= 65.54, "Moderate",
                                                ifelse(life_expectancy_birth >= 59.70, "Low-moderate",
                                                       ifelse(life_expectancy_birth < 59.69, "Low", NA)))))) %>%
  # Filter out NA values
  drop_na(life_expect_class) %>%
  drop_na(mortality_rate)

# Make life expectancy classes into factors
life_expect_df$life_expect_class <- factor(life_expect_df$life_expect_class,
                                           levels = c("Low", "Low-moderate", "Moderate", "High-moderate","High"))

```

Sidebar {.sidebar}
======================================================================

This section shows the relationship between high mortality rate per 100,000 individuals and high life expectancy at birth in countries across the world. There is a general upward trend in mortality rate as the average life expectancy of a country increases.

These results align with the information provided by the [Center for Disease Control (CDC)](https://www.cdc.gov/aging/covid19/covid19-older-adults.html#:~:text=Increased%20Risk%20of%20Severe%20Illness%20from%20COVID%2D19,-Older%20adults%20are&text=The%20risk%20increases%20for%20people,having%20certain%20underlying%20medical%20conditions.) that risk of severe illness and death from COVID-19 is much greater in older adults.

Countries were categorized on their average life expectancy based on the following criteria from the [World Bank](https://data.worldbank.org/indicator/SP.DYN.LE00.IN?end=2020&start=2020&view=map): 

* **Low: ** < 59.69 years
* **Low-moderate: **  59.70 - 65.53 years
* **Moderate: ** 65.54 - 70.06 years
* **High-moderate:** 70.07 - 74.75 years
* **High: ** 74.76 years or more

**Chart 6** shows results from the ANOVA analyses where means not sharing any letter are significantly different at the 5% significance level. At alpha = 0.05, mean mortality rate for countries with a high life expectancy at birth differs significantly from that for low, low- moderate, moderate, and high-moderate classes. In addition, the mean mortality rate for countries with high-moderate life expectancy at birth class differs significantly from countries with low, low-moderate, and moderate classification. Overall, the mortality rate is higher for the high and high-moderate classes. All other comparisons are not statistically significant.

**How to use:** to view the mortality rate and the average life expectancy for a specific country, drag your cursor over the point. 

Life Expectancy Data
======================================================================

Row
-----------------------------------------------------------------------

### **Chart 5:** Relationship Between COVID-19 Mortality Rate and Life Expectancy per Regions Globally
```{r Chart 5}
x1 <- ggplot(region_mort_tb1, aes(text = paste("country: ",country),x=life_expectancy_birth, y=mortality_rate, color = region)) + geom_point() + facet_wrap(.~ region, nrow = 2) + labs(y = "COVID-19 Mortality Rate", x = "Life Expectancy at Birth (years)") + theme_minimal() + theme(axis.title = element_text(face="bold"))

x1 <- ggplotly(x1)

x1 %>%
  layout(showlegend = F)
```


Row 
-----------------------------------------------------------------------
### **Chart 6:** ANOVA Result Showing Multiple Comparisons of Relationship Between Mortality Rate and Life Expectancy Class
```{r Chart 6}
plot_ly(dt3, x = ~life_expect_class, y = ~mean_mortality_rate, type = 'bar', text = ~cld3$Letters, textposition = "none", colors = c("#16c91f", "hot pink", "#31befd"), color = ~cld3$Letters, error_y = list(array = ~standard_error, color = 'grey')) %>% layout(xaxis = list(title = '<b>Life Expectancy at Birth Class</b>'), yaxis = list(title = '<b>Mean COVID-19 Mortality Rate</b>', range = c(0, 185)))
```

### **Chart 7:** Global Life Expectancy at Birth in Relation to Mortality Rate 
```{r Chart 7}
x4 <- ggplot(region_mort_tb1, aes(text = paste("country: ",country), x=life_expectancy_birth, y=mortality_rate, colour=region)) + 
           geom_point() + theme_minimal() + labs(y = "COVID-19 Mortality Rate", x = "Life Expectancy at Birth (years)") + theme(axis.title = element_text(face="bold"))
                 
x4 <- ggplotly(x4) 

x4 %>%
  layout(legend = list(title=list(text = "Region"))) %>%
  layout(legend = list(orientation = 'v', x = 0.01, y = 1)) %>%
  layout(legend = list(font = list(size = 9)))
```





